asyncapi: 3.0.0
info:
  title: Hotel Domain
  version: 1.0.0
  description: Example API for Flea
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'
  tags:
    - name: hotel
defaultContentType: application/json
servers:
  local:
    host: 'localhost:8000'
    protocol: aws event bridge
    description: Local broker
channels:
  hotel.command:
    address: hotel.command
    messages:
      commandAddHotelRoom.message:
        $ref: '#/components/messages/commandAddHotelRoom'
    x-flea:
      channelType: commandHandler
  hotel.event:
    address: hotel.event
    messages:
      eventAddHotelRoomSubmitted.message:
        $ref: '#/components/messages/eventAddHotelRoomSubmitted'
    x-flea:
      channelType: eventBus
operations:
  receiveCommandAddHotelRoom:
    action: receive
    channel:
      $ref: '#/channels/hotel.command'
    messages:
      - $ref: '#/channels/hotel.command/messages/commandAddHotelRoom.message'
  sendEventAddHotelRoomSubmitted:
    action: send
    channel:
      $ref: '#/channels/hotel.event'
    messages:
      - $ref: '#/channels/hotel.event/messages/eventAddHotelRoomSubmitted.message'
  receiveEventAddHotelRoomSubmitted:
    action: receive
    channel:
      $ref: '#/channels/hotel.event'
    messages:
      - $ref: '#/channels/hotel.event/messages/eventAddHotelRoomSubmitted.message'
  receiveEventHotelRoomPaymentProcessed:
    action: send
    channel:
      $ref: 'libs/flea/asyncapi-generator-typescript-cdk-event-bridge/src/lib/test-fixtures/test-payment-asyncapi.yaml#/channels/payment.event'
    messages:
      - $ref: 'libs/flea/asyncapi-generator-typescript-cdk-event-bridge/src/lib/test-fixtures/test-payment-asyncapi.yaml#/channels/payment.event/messages/eventHotelRoomPaymentProcessed.message'
components:
  messages:
    commandAddHotelRoom:
      name: command/addHotelRoom
      title: Add hotel Room
      contentType: application/json
      payload:
        $ref: '#/components/schemas/CommandAddHotelRoom'
    eventAddHotelRoomSubmitted:
      name: event/AddHotelRoomSubmitted
      payload:
        $ref: '#/components/schemas/EventAddHotelRoomSubmitted'
  schemas:
    CommandAddHotelRoom:
      additionalProperties: false
      type: object
      properties:
        roomId:
          type: string
          format: uuid
        sentAt:
          $ref: '#/components/schemas/sentAt'
    EventAddHotelRoomSubmitted:
      allOf:
        - $ref: '#/components/schemas/EventEnvelope'
        -
          type: object
          additionalProperties: false
          required:
            - eventId
          properties:
            eventId:
              type: string
              format: uuid
            roomId:
              type: string
              format: uuid
            sentAt:
              $ref: '#/components/schemas/sentAt'
    EventEnvelope:
      additionalProperties: false
      type: object
      required:
        - id
        - sentAt
        - type
        - meta
        - scope
      properties:
        id:
          $ref: '#/components/schemas/eventId'
        sentAt:
          $ref: '#/components/schemas/sentAt'
        type:
          type: string
        meta:
          $ref: '#/components/schemas/EventEnvelopeMeta'
        scope:
          $ref: '#/components/schemas/scope'
    EventEnvelopeMeta:
      additionalProperties: false
      type: object
      required:
        - source
        - specversion
      properties:
        source:
          type: string
        specversion:
          type: string
        subject:
          $ref: '#/components/schemas/subject'
        userId:
          $ref: '#/components/schemas/userId'
        tenantId:
          $ref: '#/components/schemas/tenantId'
        eventLifeCycle:
          $ref: '#/components/schemas/eventLifeCycle'
    subject:
      additionalProperties: false
      type: object
      properties:
        id:
          type: string
        entity:
          type: string
        revision:
          type: string
    eventLifeCycle:
      additionalProperties: false
      type: object
      required:
        - correlationId
        - chain
      properties:
        correlationId:
          $ref: '#/components/schemas/correlationId'
        chain:
          type: array
          items:
            $ref: '#/components/schemas/eventLifeCycleChainItem'
    eventLifeCycleChainItem:
      additionalProperties: false
      type: object
      required:
        - eventId
        - sentAt
      properties:
        eventId:
          $ref: '#/components/schemas/eventId'
        sentAt:
          $ref: '#/components/schemas/sentAt'
    eventId:
      type: string
      format: uuid
    correlationId:
      type: string
      format: uuid
    sentAt:
      type: string
      format: date-time
      description: Date and time when the message was sent.
    userId:
      type: string
      format: uuid
    tenantId:
      type: string
      format: uuid
    scope:
      type: string
      enum:
        - domain
        - integration
